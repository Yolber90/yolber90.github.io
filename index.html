<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <treta name="viewport" content="widr=device-widr, initial-scale=1.0tr">
        <title>Document</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="https://kit.fontawesome.com/ab9a9d34df.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="app.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <header>
        <h1 class="appName">Rocket Launch App</h1>
    </header>
    <div class="container-fluid">
        <h2>Upcoming Launches</h2>
        <form>
            <lable id="agency" name="agency">Agency</lable>
            <select id="agency" class="agency">
                <option value="All">All</option>
            </select>
            <button id="submit" before="asdf">Submit</button>Results:   <span id="hits"></span><br>
            <table>
                <tr>

                    <th>Next Launch</th>
                    <th>Provider</th>
                    <th>Vehicle</th>
                    <th>T-</th>
                </tr>
                <tr>
                    <td id="next-launch"></td>
                    <td id="provider"></td>
                    <td id="vehicle"></td>
                    <td id="t-minus"></td>
                </tr>
            </table>
            <!-- <p>Results:</p>
            <p id="hits" style="font-weight: 800;"></p><br><br>
            <p>Next Three Launches</p>
            <p id="next-launch" style="font-weight: 800;"></p> -->

        </form>
        <hr>
    </div>
    <div>

    </div>

    <script type="text/javascript">

        $(document).ready(function () {


            $.get("https://fdo.rocketlaunch.live/json/launches?key=49d3c350-8af8-4606-ba6d-f67f4bcaca8f", function (data) {


                
                const launches = data['result']

                let providerOptions = []
                for (let i = 0; i < launches.length; i++) {
                    providerOptions.push(launches[i]['provider']['name'])
                }

                // Creates a new set of all providers with duplicates removed
                var providerOptions2 = [...new Set(providerOptions)].sort();

                // Pickup unduplicated providers and append to options, create a drop down with all providers
                providerOptions2.map(OptPro => {
                    $(".agency").append(
                        "<option value ='" + OptPro + "''>" + OptPro + "</option>"
                    );
                })

                // On Load, auto click the submit button, thsi will load 'All' launches.
                $(function(){
                    $("#submit").click()
                })

                $("#submit").on("click", function (e) {
                    
                    
                    let provider = []
                    let vehicle = []
                    let mission = []
                    let locationCo = []
                    let locationName = []
                    let padName = []
                    let description = []
                    let time = []


                    for (let i = 0; i < launches.length; i++) {

                        function fillFields() {
                            provider.push(launches[i]['provider']['name'])
                            vehicle.push(launches[i]['vehicle']['name'])
                            mission.push(launches[i]['missions'][0]['name'])
                            locationCo.push(launches[i]['pad']['location']['country'])
                            locationName.push(launches[i]['pad']['location']['name'])
                            padName.push(launches[i]['pad']['name'])
                            description.push(launches[i]['launch_description'])
                            time.push(launches[i]['sort_date'])

                        }
                        function timeTranslator(tm) {
                            if (tm == null) {
                                return 'TBD';
                            } else {
                                return new Date(tm * 1000)
                            }
                        }
                        

                        function tMinus(){
                            // Interval will re-run every second, updating the countdow time.
                            setInterval(function(){
                                
                                let total = new Date(time[0] * 1000) - new Date();
                                let seconds = Math.floor((total / 1000) % 60);
                                let minutes = Math.floor((total / 1000 / 60) % 60);
                                let hours = Math.floor((total / (1000 * 60 * 60)) % 24);
                                let days =  Math.floor(total / (1000 * 60 * 60 * 24));


                                // load html with countdown, used terinary operator (arg? if true: if false) to return a 0 in fron of time if < 10
                                $("#t-minus").html(
                                    days + " Days<br>" + 
                                    (hours < 10 ? '0' + hours: hours) + "h:" + 
                                    (minutes < 10? '0' + minutes: minutes) + "m:" + 
                                    (seconds < 10 ? '0' + seconds: seconds) + "s"
                                )
                                


                            }, 1000)

                        }
                        
                        
                        
                        
                        tMinus(time[0])
                        $("#vehicle").html(vehicle[0]);
                        $("#provider").html(provider[0]);
                        
                        
                        
                        if ($(".agency").val() == 'All') {
                            fillFields()

                        } else if (launches[i]['provider']['name'] == $(".agency").val()) {
                            fillFields()

                        } else { }

                        // On Submit, remove div results & childs, then re-append with new variables.
                        

                    }
                    
                    $(".results").remove();
                    

                    for (let i = 0; i < provider.length; i++) {
                        
                        $("#hits").html(provider.length);
                        $("#next-launch").html(timeTranslator(time[0]));
                        
                        // $("#t-minus").html(new Date());


                        $(".container-fluid").append(
                            "<div class='results shadow p-3 mb-5 bg-white rounded'>" +
                                "<div class='rocketImg'>" +
                                "<img  src='media/" + vehicle[i] + ".jpg' alt='" + vehicle[i] + "''>" + //Loads the image from media folder.
                            "</div>" +
                                "<div class='rocketDetails1'>" +
                                    "<table cellpadding=5>" +
                                        "<tr>" +
                                            "<th>Launch Provider</th>" +
                                            "<th>Vehicle</th>" +
                                            "<th>Mission</th>" +
                                            "<th>Country</th>" +
                                            "<th>Launch Site</th>" +
                                            "<th>Pad</th>" +
                                        "</tr>" +
                                        "<tr>" +
                                            "<td>" + provider[i] + "</td>" +
                                            "<td>" + vehicle[i] + "</td>" +
                                            "<td>" + mission[i] + "</td>" +
                                            "<td>" + locationCo[i] + "</td>" +
                                            "<td>" + locationName[i] + "</td>" +
                                            "<td>" + padName[i] + "</td>" +
                                        "</tr>" +
                                    "</table>" +
                                    "<hr>" +
                                    "<table>" +
                                        "<tr>" +
                                            "<th >Launch Date/Time</th>" +
                                            "<td>" + timeTranslator(time[i]) + "</td>" +
                                            "<th>T-minus</th>" +
                                            "<td id='tminus-td'></td>" + 
                                        "</tr>" +
                                    "</table>" +
                            
                            "<p style='margin-left: 10px' class='text-primary'>Mission Description:</p>" +
                            "<p style='margin-left: 10px'>" + description[i] + "</p>" +
                            "</div>"

                        )
                        $("th").addClass("text-primary")
                        $("td").addClass("text-secondary")
                    }
                    e.preventDefault(); // Prevents page from reloading


                });




            })



        });
    </script>

</body>

</html>