<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <treta name="viewport" content="widr=device-widr, initial-scale=1.0tr">
        <title>Document</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="https://kit.fontawesome.com/ab9a9d34df.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="app.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <header>
        <h1 class="appName">Rocket Launch App</h1>
    </header>
    <div class="container">
        <h2>Upcoming Launches</h2>
        <form>
            <lable id="agency" name="agency">Agency</lable>
            <select id="agency" class="agency">
                <option value="All">All</option>                
            </select>
            <button id="submit">Submit</button>
        </form>
        <hr>
    </div>
    <div>

    </div>

    <script type="text/javascript">
        
        $(document).ready(function () {


            $.get("https://fdo.rocketlaunch.live/json/launches?key=49d3c350-8af8-4606-ba6d-f67f4bcaca8f", function (data) {
                

                
                const launches = data['result']
                
                let provider = []
                let vehicle = []
                let mission = []
                let locationCo = []
                let locationName = []
                let padName = []
                let description = []
                let time = []

                



                
                let providerOptions = []
                for(let i = 0; i < launches.length; i++){
                    providerOptions.push(launches[i]['provider']['name'])
                }
                var providerOptions2 = [...new Set(providerOptions)].sort();                
                
                providerOptions2.map(OptPro => {
                    $(".agency").append(
                        "<option value ='" + OptPro + "''>" + OptPro + "</option>"
                    );
                })



                $("#submit").on("click", function (e) {
                    let provider = []
                    let vehicle = []
                    let mission = []
                    let locationCo = []
                    let locationName = []
                    let padName = []
                    let description = []
                    let time = []

                    
                    for(let i = 0; i < launches.length ; i++){

                        function fillFields(){
                            provider.push(launches[i]['provider']['name'])
                            vehicle.push(launches[i]['vehicle']['name'])
                            mission.push(launches[i]['missions'][0]['name'])
                            locationCo.push(launches[i]['pad']['location']['country'])
                            locationName.push(launches[i]['pad']['location']['name'])
                            padName.push(launches[i]['pad']['name'])
                            description.push(launches[i]['launch_description'])
                            time.push(launches[i]['win_open'])

                        }
                        function timeTranslator(tm){
                            if(tm == null){
                                return 'TBD';
                            }else{
                                return new Date(tm);
                            }
                        }


                        if($(".agency").val() == 'All'){
                            fillFields()
                            
                        }else if(launches[i]['provider']['name'] == $(".agency").val()){
                            fillFields()

                        }else{
                        
                        }

                }

                
                
                $(".results").empty();
                $(".results").remove()
                
                for(let i = 0; i < provider.length ; i++){
                    
                    $(".container").append(
                        "<div class='results shadow p-3 mb-5 bg-white rounded'>" +
                            "<div class='rocketImg'>" +
                                "<img  src='/media/" + vehicle[i] + ".jpg' alt='" + vehicle[i] + "'>" +
                            "</div>" + 
                        "<div class='rocketDetails1'>" +
                            "<table cellpadding=5>"+
                            "<tr>"+
                                "<th>Launch Provider</th>"+
                                "<th>Vehicle</th>" +
                                "<th>Mission</th>" +
                                "<th>Country</th>" +
                                "<th>Launch Site</th>" +
                                "<th>Pad</th>" +
                            "</tr>" +
                            "<tr>" +
                                "<td>" + provider[i] +"</td>" +
                                "<td>" + vehicle[i] + "</td>" +
                                "<td>" + mission[i] + "</td>" +
                                "<td>" + locationCo[i] + "</td>" +
                                "<td>" + locationName[i] + "</td>" +
                                "<td>" + padName[i] + "</td>" +
                            "</tr>" +
                        "</table>" +
                        "<hr>" +
                        "<table>" +
                            "<tr>" +
                                "<th >Launch Date/Time</th>" +
                                "<td>" + timeTranslator(time[i]) + "</td>" +
                            "</tr>" +
                        "</table>" +
                        "<p style='margin-left: 10px' class='text-primary'>Mission Description:</p>" +
                        "<p style='margin-left: 10px'>" + description[i] + "</p>" +
                    "</div>"
                    
                    )
                    $("th").addClass("text-primary")
                    $("td").addClass("text-secondary")
                    
                    

                }
                e.preventDefault(); // Prevents page from reloading
                
                    
                });
                
                
                

            })
            


        });
    </script>

</body>

</html>